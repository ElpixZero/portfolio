!function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=145)}({145:function(t,e,i){t.exports=i("azUc")},azUc:function(t,e,i){"use strict";i.r(e);var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],a=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(a=(r=s.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){n=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var r="doc",s="photo",l="video",h="album",d="market_album",c=1,u=1.777,v=1.5,p=window.isMVK?200:120,g=5,m=6,f=3,w=window.isMVK?604:537,b=window.isMVK?360:343;function y(t,e,i,a){var n={id:t.id,width:intval(e),height:intval(i),lastColumn:a.lastColumn,lastRow:a.lastRow,single:a.single,image:_(t,e,i,a.single),unsized:t.unsized,type:t.type,orig:t};return t.title&&void 0!==t.size?extend(n,{title:t.title,size:t.size}):t.title&&void 0!==t.msize?extend(n,{title:t.title,msize:t.msize}):t.type===l&&t.name&&void 0!==t.name&&extend(n,{name:t.namem}),"number"==typeof t.duration&&(t.duration=formatTime(t.duration)),n.unsized?n.ratio=c:n.ratio=n.image.width/n.image.height,n}function _(t,e,i,a){if(!t)return{};e=intval(e),i=intval(i);var n=window.devicePixelRatio||1,o=void 0;if(t.type===l||t.type===r){(t.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach(function(a){t.sizes[a]&&(!o||e*n<=t.sizes[a][1]&&i*n<=t.sizes[a][2])&&(o=t.sizes[a])})}else{var s=t.thumb?t.thumb.sizes:t.sizes,h=s.x||s[s.length-1],d=h?(h[1]||1)/(h[2]||1):c,u=0;d>e/i?(u=i,d>1&&(u*=d)):(u=e,d<1&&(u/=d)),i*=n,e*=n;var v=!a&&s.o,p="";p=s.temp?"temp":u<75?"s":u<130?"m":v&&s.o&&s.o[1]>=e&&s.o[2]>=i?"o":v&&s.p&&s.p[1]>=e&&s.p[2]>=i?"p":v&&s.q&&s.q[1]>=e&&s.q[2]>=i?"q":v&&s.r&&s.r[1]>=e&&s.r[2]>=i?"r":"x",o=s[p]}return o[1]=intval(o[1]),o[2]=intval(o[2]),o[1]&&o[2]||(t.unsized=!0),{src:o[0],width:o[1],height:o[2]}}function x(t,e,i){var a=void 0;switch(t.type){case r:a=t.ratio;break;case l:a=t.ratio||u;break;case h:case d:a=v;break;default:if(t.sizes&&t.sizes.x){var n=o(t.sizes.x,3),s=n[1],p=n[2];s&&p&&(a=s/p)}if(t.sizes&&t.sizes.temp){var g=o(t.sizes.temp,3),m=g[1],f=g[2];m&&f&&(a=m/f)}}return a||c}function C(t){return!!~[r,s,l,h,d].indexOf(t.toString())}function z(t,e){var i=M(t)||void 0===t.length?{}:[];for(var n in t)(!/webkit/i.test(_ua)||"layerX"!=n&&"layerY"!=n&&"webkitMovementX"!=n&&"webkitMovementY"!=n)&&(e&&"object"===a(t[n])&&"prototype"!==n&&null!==t[n]?i[n]=z(t[n]):i[n]=t[n]);return i}var M=function(t){return"[object Object]"===Object.prototype.toString.call(t)};var E=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],a=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(a=(r=s.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){n=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.ThumbsEdit={cache:function(){return cur._thEdCache||(cur._thEdCache={}),cur._thEdCache},loaded:function(){return cur._thEdLoaded||(cur._thEdLoaded={}),cur._thEdLoaded},cur:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return cur._thEdCur||(cur._thEdCur={}),cur._thEdCur}),getMedias:function(t){var e=this,i=[];return(t=ge(t))?((this.cache()[t.id]?this.cache()[t.id].previews:[]).forEach(function(t){e.isValidThumbType(t.type)&&i.push([t.type,t.ownerId+"_"+t.itemId])}),i):i},init:function(t,e,i){var a=this;if(t=ge(t)){(i="boolean"==typeof i?{wide:i}:clone(i)||{}).width&&i.height?i.force=!0:(i.width=t.parentNode.offsetWidth,i.height=Math.round(i.width/1.5));var n=[];e.forEach(function(t){a.isValidThumbType(t.type)&&n.push(t)}),domData(t,"te-inited",1),this.cache()[t.id]={previews:n,opts:i,wide:i.wide,height:0,thumbs:[]};var o=this.cur().timer;o&&clearTimeout(o),n.length?this.cur().timer=setTimeout(function(){var e=a.processThumbs(i.width,i.height,n,i);a.cache()[t.id].thumbs=e.thumbs,a.cache()[t.id].height=e.height;var o=cf();e.thumbs.forEach(function(t,e){o.appendChild(a.createThumbEl(t,e))}),val(t,""),toggleClass(t,"wide",i.wide),setStyle(t,{width:e.width,height:e.height}),t.appendChild(o),show(t)},0):(hide(t),val(t,""))}},getParentTooltipCls:function(t){return gpeByClass("_im_text_input",t)?"_im_text_input":"thumb_wrap"},loadAndDisplayImage:function(t,e){var i=this;if(t&&e&&e.oldImage){var a=new Image,n=e.image,o=e.oldImage;if(this.loaded()[n.src]&&t.src!==n.src)return t.src=n.src,void delete e.oldImage;addEvent(a,"load",function r(){t.src===o.src&&(t.src=n.src,delete e.oldImage,i.loaded()[n.src]=!0),removeEvent(a,"load",r)}),a.src=n.src}},createThumbEl:function(t,e){var i=this;if(t&&this.isValidThumbType(t.type)){var a=t.oldImage||t.image,n=this.crop(t,t.width,t.height),o="draggable_thumb _draggable clear_fix"+(t.unsized?" unsized"+(t.single?" unsized_single":""):""),c=void 0,u="thumb_wrap fl_l thumb_"+t.type+"_wrap";switch(t.lastColumn&&(u+=" last_column"),t.lastRow&&(u+=" last_row"),t.height<50&&(u+=" thumb_no_controls"),t.type){case h:case d:t.image.src.match(/^\/images\//)&&(u+=" page_album_nocover"),(t.title||t.thumb)&&(c='\n            <div class="page_album_title">\n              <div class="page_album_size">'+(t.msize||t.size)+'</div>\n              <div class="page_album_title_text">'+t.title+"</div>\n            </div>\n          ");break;case s:c='\n          <div class="photo_thumb_btns_container">\n            <div class="photo_thumb_btns_overlay">\n              <div class="photo_thumb_btns">\n                <div class="photo_thumb_btn_show _photo_thumb_btn_show" id="ui_btn_show"></div>\n                '+(isPhotoeditor3Available()&&!vk.widget?'<div class="photo_thumb_btn_editor _photo_thumb_btn_editor" id="ui_btn_pe"></div>':"")+"\n              </div>\n            </div>\n          </div>\n        ";break;case r:c="\n          "+t.orig.label+'\n          <a href="'+t.orig.href+'" class="post_doc_thumb_link" target="_blank" rel="noopener"></a>\n        ';break;case l:var v=t.orig.duration,p=intval(t.width)>=250&&t.orig.platform||"",g="video_thumb_label";t.orig.active_live?(v='<span class="video_thumb_label_live_icon"></span>',g+=" _live"):(t.orig.play_icon&&(intval(t.width)>=250?c='<div class="page_post_video_play_inline"></div>':g+=" _has_play_icon"),v||(g+=" _no_duration")),(v||p||t.orig.play_icon)&&(c='\n            <div class="'+g+'">\n              <span class="video_thumb_label_item">'+p+'</span><span class="video_thumb_label_item">'+v+"</span></div>\n            </div>\n          ")}var m=t.unsized?"":'\n      <img class="preview _preview" src="'+clean(a.src)+'" width="'+Math.round(n.width)+'" height="'+Math.round(n.height)+'" style="margin:'+n.marginTop+"px 0 0 "+n.marginLeft+'px;"/>\n    ',f='\n      <div index="'+e+'" attachment="'+t.id+'" class="'+u+'"'+(t.name?' aria-label="'+clean(t.name)+'"':"")+' style="width: '+intval(t.width)+"px;height: "+intval(t.height)+'px;">\n        <div class="'+o+'" '+(t.unsized?' style="background-image:url('+clean(a.src)+')"':"")+">\n          "+m+"\n          "+c+'\n          <div class="overlay _overlay"></div>\n          <div class="ui_thumb_x_button _close_btn" role="link" aria-label="'+clean(getLang("dont_attach"))+'">\n            <div class="ui_thumb_x"></div>\n          </div>\n        </div>\n      </div>\n    ',w=se(f),b=geByClass1("_preview",w),y=geByClass1("_draggable",w),_=geByClass1("_close_btn",w);if(t.oldImage&&b&&this.loadAndDisplayImage(b,t),addEvent(y,"click",function(t){if(i.cur().updating||domClosest("_close_btn",t.target))cancelEvent(t);else{var e=gpeByClass("thumb_wrap",t.target),a=i.cache()[e.parentNode.id].previews[e.getAttribute("index")].click;cur.openEditor=hasClass(t.target,"_photo_thumb_btn_editor"),isFunction(a)&&a(t)}}),addEvent(y,"mousedown touchstart",function(t){return i.startDrag(t)}),addEvent(_,"click",function(t){var e=gpeByClass("thumb_wrap",t.target);hide(geByClass1("_draggable",e)),i.removeMedia(e.parentNode.id,e.getAttribute("index"))}),addEvent(_,"mouseover",function(){return showTooltip(_,{text:getLang("dont_attach"),shift:[11,8],black:1})}),t.type===s){var x=geByClass1("_photo_thumb_btn_show",w);x&&addEvent(x,"mouseover",function(){return showTooltip(x,{text:getLang("global_photo_attach_show"),shift:[10,8],black:1,appendParentCls:i.getParentTooltipCls(y)})});var C=geByClass1("_photo_thumb_btn_editor",w);C&&addEvent(C,"mouseover",function(){return showTooltip(C,{text:getLang("global_pe_edit"),shift:[9,8],black:1,appendParentCls:i.getParentTooltipCls(y)})})}return w}},getCoords:function(t,e){var i=[];return e=e||getXY(t),Array.from(t.childNodes).forEach(function(t){if(hasClass(t,"thumb_wrap")){var a=getXY(t);i[i.length]={id:t.getAttribute("attachment"),x:intval(a[0]-e[0]),y:intval(a[1]-e[1]),width:intval(t.offsetWidth),height:intval(t.offsetHeight),index:intval(t.getAttribute("index")),node:t}}}),i},startDrag:function(t){var e=this,i=t.touches&&1==t.touches.length,a=void 0==t.button||0!=t.button&&!(1==t.button&&browser.msie8);if(hasClass(t.target,"_photo_thumb_btn_show")||hasClass(t.target,"_photo_thumb_btn_editor"))return cancelEvent(t);if(!(a&&!i||domClosest("_close_btn",t.target)||this.cur().updating)){var n=gpeByClass("draggable_thumb",t.target),o=gpeByClass("editable_thumbs",n),r=this.cache()[o.id];if(r&&!((r.previews||[]).length<2))return this.cur().el=n,this.cur().dragHandler=function(t){return e.drag(t)},this.cur().dropHandler=function(t){return e.drop(t)},addEvent(window,"mousemove touchmove",this.cur().dragHandler),addEvent(window,"mouseup touchend touchcancel",this.cur().dropHandler),i||cancelEvent(t)}},drag:function(t){var e=this.cur().el;if(t.touches&&t.touches.length>1)return this.drop();var i=browser.android?t.touches[0].pageX+(t.pageX||0):t.pageX,a=browser.android?t.touches[0].pageY+(t.pageY||0):t.pageY,n=this.cur();if(hasClass(e,"moving")){var o=i-(n.pos[0]+n.x),r=a-(n.pos[1]+n.y);setStyle(e,{left:o,top:r});var s=n.wpos,l={x:o=n.pos[0]+intval(e.style.marginLeft)+o-s[0],y:r=n.pos[1]+intval(e.style.marginTop)+r-s[1],offsetX:e.offsetWidth,offsetY:e.offsetHeight,index:n.i,node:e},h=!1,d=n.i,c=-1,u=g;each(n.coords,function(t,e){if(t!=n.i&&t!=c){e.offsetX=e.node.offsetWidth+u,e.offsetY=e.node.offsetHeight+u;var i=n.coords[t-1],a=n.coords[t+1],o=l.x+l.offsetX/2,r=l.y+l.offsetY/2,s=e.x+e.offsetX/2,v=e.y+e.offsetY/2,p=e.x+e.offsetX,g=e.y+e.offsetY,m=(i&&i.x==e.x&&i.y!=e.y&&0!=e.y||a&&a.x==e.x&&a.y!=e.y)&&0!=e.x,f=o>=s&&(a&&(o<=a.x+a.offsetX/2&&(a.offsetY==e.offsetY||o<p)||a.y!=e.y)||!a&&l.x<=p)&&r>e.y&&r<g,w=o<s&&o>=e.x&&(!i||i.y!=e.y&&!(i.x==e.x&&!a))&&r>e.y&&r<g,b=m&&r>=v&&r<g&&o>e.x&&o<p,y=m&&r<v&&r>=e.y&&o>e.x&&o<p;f=f&&!m,w=w&&!m&&!f,(f||w||b||y)&&(h=!0,d=e.index<n.i&&(f||b)?e.index+1:l.index<e.index&&(y||w)?e.index-1:e.index),d!=n.i?setStyle(e.node,{left:f?-2:w?2:0,top:b?-2:y?2:0}):setStyle(e.node,{left:0,top:0}),f&&a&&a.y==e.y&&a.x>e.x&&l.index>e.index&&(setStyle(e.node,{left:0,top:0}),setStyle(a.node,{left:2,top:0}),c=t+1),b&&a&&a.x==e.x&&a.y>e.y&&r<=v&&(setStyle(a.node,{left:0,top:0}),c=t+1),y&&i&&i.x==e.x&&i.y<e.y&&r<=v&&(setStyle(i.node,{left:0,top:-2}),setStyle(e.node,{left:0,top:0}))}}),n.to_i=h?d:n.i}else{var v=e.parentNode.parentNode,m=geByClass1("_overlay",e),f=geByClass1("_preview",e),w=intval(e.parentNode.getAttribute("index")),b=this.cache()[v.id].thumbs[w],y=getXY(v),_=getXY(e.parentNode),x=this.getCoords(v,y);n.id=v.id,n.i=w,n.to_i=w,n.x=i-_[0],n.y=a-_[1],n.t=b,n.w=b.width,n.h=b.height,n.pos=_,n.wpos=y,n.crop=this.crop(b,b.width,b.height),n.coords=x;var C=this.scale(b.width,b.height,75),z=E(C,2),M=z[0],T=z[1],k=intval((b.width-M)*(browser.mobile?.5:n.x/b.width)),S=intval((b.height-T)*(browser.mobile?.5:n.y/b.height));addClass(e,"moving"),setStyle(e,"zIndex",100);var I={duration:p,transition:Fx.Transitions.easeOutCubic},R=this.crop(b,M,T);animate(e,{opacity:.85,width:M,height:T,marginLeft:k,marginTop:S},I),animate(m,{opacity:1},I),f&&animate(f,R,I)}return cancelEvent(t)},drop:function(t){var e=this.cur();document.removeEventListener("touchmove",this.preventScroll),e.updating=!0;var i=e.el,a=geByClass1("_overlay",i),n=geByClass1("_preview",i);if(removeEvent(window,"mousemove touchmove",e.dragHandler),removeEvent(window,"mouseup touchend touchcancel",e.dropHandler),!hasClass(i,"moving"))return e.updating=!1,cancelEvent(t);if(e.to_i==e.i){var o=e.crop,r={duration:p,transition:Fx.Transitions.easeOutCubic};animate(i,{marginTop:0,marginLeft:0,top:0,left:0,width:e.w,height:e.h,opacity:1},extend(r,{onComplete:function(){setStyle(i,"zIndex",null),e.updating=!1}})),animate(a,{opacity:0},r),n&&animate(n,o,r)}else{var s=this.cache()[e.id].previews;s=this.move(s,e.i,e.to_i),this.update(e.id,s),isFunction((this.cache()[e.id].opts||{}).onMove)&&this.cache()[e.id].opts.onMove()}return removeClass(i,"moving"),cancelEvent(t)},update:function(t,e){var i=this;if(t=ge(t)){var a=t.id,n=ge(a),o=this.cache()[n.id],r=o.thumbs,s=o.height,l=o.opts,h=!0===l||!1===l?{wide:l}:clone(l||{}),d=h.width,c=h.height;d&&c?h.force=!0:(d=t.parentNode.offsetWidth,c=Math.round(d/1.5));var u=this.processThumbs(d,c,e,h),v=se('\n      <div style="height: 0;overflow: hidden;">\n        <div class="_editable_thumbs editable_thumbs'+(o.wide?" wide":"")+'" style="width: '+u.width+"px;height: "+u.height+'px;"></div>\n      </div>\n    '),g=geByClass1("_editable_thumbs",v);u.thumbs.forEach(function(t,e){g.appendChild(i.createThumbEl(t,e))}),n.parentNode.appendChild(v);var m=this.getCoords(g);each(m,function(t,e){for(var a=null,n=i.cur().coords,o=0,s=n.length;o<s;++o)if(n[o].id==e.id){a=n[o];break}if(null!=a){var l=geByClass1("_draggable",a.node),h=geByClass1("_overlay",l),d=geByClass1("_preview",l),c=r[a.index],v=null;each(u.thumbs,function(t,e){e.id==c.id&&(i.loaded()[e.image.src]||(e.oldImage=c.image),v=e)}),setStyle(a.node,{left:0,top:0}),a.height==e.height&&a.width==a.width&&e.x==a.x&&e.y==a.y&&a.index!=i.cur().i||(hasClass(l,"moving")&&fadeOut(h,p),setTimeout(function(){animate(l,{top:e.y-a.y,left:e.x-a.x,marginLeft:0,marginTop:0,height:e.height,width:e.width,opacity:1},p);var t=i.crop(v,e.width,e.height);d&&animate(d,t,p),toggleClass(l,"unsized_single",v.unsized&&v.single)},4))}}),s!=u.height&&setTimeout(function(){animate(n,{height:u.height},p)},4),setTimeout(function(){isFunction(h.onUpdate)&&h.onUpdate(),setStyle(n,{height:u.height,width:u.width}),n.innerHTML="",i.cache()[a].thumbs=u.thumbs,i.cache()[a].previews=e,i.cache()[a].height=u.height,u.thumbs.forEach(function(t,e){n.appendChild(i.createThumbEl(t,e))}),re(v),i.cur().updating=!1},p)}},setWide:function(t,e,i){if(t=ge(t)){var a=this.cache()[t.id],n=clone(i||{});void 0===e&&(e=!1),n.wide=e,a.wide!=e&&this.init(t,a.previews,n)}},hasMedia:function(t,e){if(t=ge(t)){var i=t.id,a=this.cache()[i];if(a){for(var n=0;n<a.previews.length;n++)if(a.previews[n][a.previews[n].type].id==e)return!0;return!1}}},addMedia:function(t,e){if((t=ge(t))&&e){var i=t.id,a=this.cache()[i];if(a){var n=clone(a.previews);10==n.length||this.hasMedia(t,e[e.type].id)||(n[n.length]=e,this.cache()[i]=null,this.init(i,n,clone(a.opts)))}}},updateMedia:function(t,e,i,a){if((t=ge(t))&&e&&i&&a){var n=t.id,o=this.cache()[n];if(o){for(var r=clone(o.previews),s=!1,l=e+i,h=0;h<r.length;h++)if(r[h][r[h].type].id==l){var d=this.convert(e,i,a.editable);r[h]=d,s=!0;break}s&&(this.cache()[n]=null,this.init(n,r,clone(o.opts)))}}},refresh:function(t){if(t=ge(t)){var e=t.id,i=this.cache()[e];i&&(this.cache()[e]=null,this.init(e,clone(i.previews),clone(i.opts)))}},removeAll:function(t){if(t=ge(t)){var e=t.id,i=this.cache()[e];i&&(this.cache()[e]=null,this.init(e,[],i.opts))}},removeMedia:function(t,e){if(!(t=ge(t)))return null;e=intval(e);var i=this.cache()[t.id];if(i){var a=i.previews.splice(e,1),n=a[0][a[0].type].id;return each(t.childNodes,function(t,e){if(e.getAttribute&&e.getAttribute("attachment")==n){var i=(geByClass1("_close_btn",e)||{}).tt;i&&i.destroy&&i.destroy()}}),this.cur().coords=this.getCoords(t),0==i.previews.length?this.init(t,[],i.opts):this.update(t,i.previews),a[0]&&a[0].remove&&a[0].remove(),a}},removeById:function(t,e){if(!(t=ge(t)))return null;for(var i=(this.cache()[t.id]||{}).previews||[],a=0,n=i.length;a<n;++a)if(i[a].type==r&&i[a].doc.id==e||i[a].type==s&&i[a].photo.id==e||i[a].type==l&&i[a].video.id==e||i[a].type==h&&i[a].album.id==e||i[a].type==d&&i[a].market_album.id==e)return this.removeMedia(t,a);return null},processThumbs:function(t,e,i,a){var n=function(t){var e=0;return each(t,function(t,i){e+=i}),e},o=function(t,e,i){return(e-(t.length-1)*i)/n(t)},r=(a=M(a)?a:{}).wide,s=[],h=0,d=[],c=[];each(i,function(t,e){C(e.type)&&(d[d.length]=e[e.type]),e.type===l&&s.push(h),h++});var u="",v=[],p=d.length;each(d,function(t,e){var i=x(e);u+=i>1.2?"w":i<.8?"v":"q",v[v.length]=i});var _=v.length>0?n(v)/v.length:1,E=void 0,T=void 0,k=g;window.isMVK&&(k=window.innerWidth>=480?m:f);var S=k;a.force?(E=t,T=e):(r?(E=w,T=b):t>=381?(E=381,T=1==p?361:237):(E=337,T=1==p?320:214),t<E&&(E=t,T=e),window.isMVK&&(E=Math.min(w,window.innerWidth),T=Math.min(b,E)));var I=E/T,R=0,B=0;if(1==p){var O={lastColumn:1,lastRow:1,single:1};d[0].thumb?(R=279,B=185):v[0]>=1*I?(R=E,B=Math.min(R/v[0],T)):(B=T,R=Math.min(B*v[0],E));var j=y(d[0],R,B,O);!j.unsized&&(j.image.width<R&&j.image.height<=T||j.image.height<B&&j.image.width<=E)&&(R=j.image.width,B=j.image.height,j=y(d[0],R,B,O)),c[0]=j}else if(2==p){var A=void 0,Y=void 0;switch(u){case"ww":if(_>1.4*I&&v[1]-v[0]<.2){Y=E,A=Math.min(Y/v[0],Y/v[1],(T-S)/2),c[0]=y(d[0],Y,A,{lastColumn:1}),c[1]=y(d[1],Y,A,{lastColumn:1,lastRow:1}),R=E,B=2*A+S;break}case"vv":case"qv":case"vq":case"qq":Y=(E-k)/2,A=Math.min(Y/v[0],Y/v[1],T),c[0]=y(d[0],Y,A,{lastRow:1}),c[1]=y(d[1],Y,A,{lastRow:1,lastColumn:1}),R=E,B=A;break;default:var L=intval((E-k)/v[1]/(1/v[0]+1/v[1])),X=E-L-k;A=Math.min(T,L/v[0],X/v[1]),c[0]=y(d[0],L,A,{lastRow:1}),c[1]=y(d[1],X,A,{lastColumn:1,lastRow:1}),R=E,B=A}}else if(3==p)if((v[0]>1.2*I||_>1.5*I)&&"www"==u){var P=E,N=void 0,V=Math.min(P/v[0],.66*(T-S));if(c[0]=y(d[0],P,V,{lastColumn:1}),"www"==u){var H=intval(E-k)/2;N=Math.min(T-V-S,H/v[1],H/v[2]),c[1]=y(d[1],H,N,{lastRow:1}),c[2]=y(d[2],E-H-k,N,{lastColumn:1,lastRow:1})}else{var q=intval((E-k)/v[2]/(1/v[1]+1/v[2])),D=E-q-k;N=Math.min(T-V-S,q/v[2],D/v[1]),c[1]=y(d[1],q,N,{lastRow:1}),c[2]=y(d[2],q,N,{lastRow:1,lastColumn:1})}R=E,B=V+N+S}else{var U=T,W=intval(Math.min(U*v[0],.75*(E-k)));c[0]=y(d[0],W,U,{lastRow:1});var K=v[1]*(T-S)/(v[2]+v[1]),F=T-K-S,G=Math.min(E-W-k,intval(K*v[2]),intval(F*v[1]));c[1]=y(d[1],G,F,{lastColumn:1}),c[2]=y(d[2],G,K,{lastColumn:1,lastRow:1}),R=W+G+k,B=T}else if(4==p)if((v[0]>1.2*I||_>1.5*I)&&"wwww"==u){var J=E,Q=Math.min(J/v[0],.66*(T-S));c[0]=y(d[0],J,Q,{lastColumn:1});var Z=(E-2*k)/(v[1]+v[2]+v[3]),$=intval(Z*v[1]),tt=intval(Z*v[2]),et=J-$-tt-2*k;Z=Math.min(T-Q-S,Z),c[1]=y(d[1],$,Z,{lastRow:1}),c[2]=y(d[2],tt,Z,{lastRow:1}),c[3]=y(d[3],et,Z,{lastColumn:1,lastRow:1}),R=E,B=Q+Z+S}else{var it=T,at=Math.min(it*v[0],.66*(E-k)),nt=(T-2*S)/(1/v[1]+1/v[2]+1/v[3]),ot=intval(nt/v[1]),rt=intval(nt/v[2]),st=it-ot-rt-2*S;at+(nt=Math.min(E-at-k,nt))+k<E&&it*v[0]>at&&(at=Math.min(it*v[0],E-k-nt)),c[0]=y(d[0],at,it,{lastRow:1}),c[1]=y(d[1],nt,ot,{lastColumn:1}),c[2]=y(d[2],nt,rt,{lastColumn:1}),c[3]=y(d[3],nt,st,{lastColumn:1,lastRow:1}),R=at+nt+k,B=T}else{var lt=[],ht=0;_>(s.length?1.3:1.1)?each(v,function(t,e){lt[lt.length]=Math.max(1,e)}):each(v,function(t,e){~s.indexOf(ht)?lt[lt.length]=e:lt[lt.length]=Math.min(1,e),ht++});var dt={},ct=void 0,ut=void 0;for(dt[p+""]=[o(lt,E,k)],ct=1;ct<=p-1;ct++)dt[ct+","+(ut=p-ct)]=[o(lt.slice(0,ct),E,k),o(lt.slice(ct),E,k)];for(ct=1;ct<=p-2;ct++)for(ut=1;ut<=p-ct-1;ut++)dt[ct+","+ut+","+(p-ct-ut)]=[o(lt.slice(0,ct),E,k),o(lt.slice(ct,ct+ut),E,k),o(lt.slice(ct+ut),E,k)];var vt=null,pt=0,gt=void 0;for(var mt in dt)if(dt.hasOwnProperty(mt)){var ft=dt[mt],wt=n(ft)+S*(ft.length-1),bt=Math.abs(wt-T);if(~mt.indexOf(",")){for(var yt=mt.split(","),_t=0;_t<yt.length;_t++)yt[_t]=intval(yt[_t]);(yt[0]>yt[1]||yt[2]&&yt[1]>yt[2])&&(bt+=50,bt*=1.5)}(null===vt||bt<pt)&&(vt=mt,pt=bt,gt=wt)}for(var xt=z(d),Ct=z(lt),zt=vt.split(","),Mt=dt[vt],Et=zt.length-1,Tt=0;Tt<zt.length;Tt++){var kt=parseInt(zt[Tt]),St=xt.splice(0,kt),It=Mt.shift(),Rt=St.length-1,Bt={};Et==Tt&&(Bt.lastRow=!0);for(var Ot=E,jt=0;jt<St.length;jt++){var At=St[jt],Yt=Ct.shift(),Lt=Bt,Xt=void 0;Rt==jt?(Xt=Math.ceil(Ot),Lt.lastColumn=!0):Ot-=(Xt=intval(Yt*It))+k,c[c.length]=y(At,Xt,It,Lt)}}R=E,B=gt}return{width:intval(R),height:intval(B),thumbs:c}},compute:y,getSize:_,move:function(t,e,i){if(i>=t.length)for(var a=i-t.length;1+a--;)t.push(void 0);return t.splice(i,0,t.splice(e,1)[0]),t},scale:function(t,e,i,a){i=intval(i),a=intval(a)||i;var n=t,o=e;return t>=e&&t>i?(n=intval(i),o=intval(e/(t/i))):t<e&&e>a&&(o=intval(a),n=intval(t/(e/a))),[n,o]},crop:function(t,e,i){var a=e,n=i,o=0,r=0;if(!t.vid&&t.image.width&&t.image.height){var s=t.image.width/t.image.height;s<e/i?(t.single&&t.image.width<e&&(e=t.image.width,i=Math.min(i,t.image.height)),(n=(a=e)/s)>i&&(r=-intval((n-i)/2))):(t.single&&t.image.height<i&&(i=t.image.height,e=Math.min(e,t.image.width)),(a=(n=i)*s)>e&&(o=-intval((a-e)/2)))}return{width:a,height:n,marginLeft:o,marginTop:t.orig&&(t.type===d||t.type===h)&&t.single?0:r}},getRatio:x,convert:function(t,e,i,a){var c=e.split("_"),u=o(c,2),v=u[0],p=u[1],g=n({owner_id:v,ownerId:v,itemId:p,type:t,remove:i.remove,click:i.click,temp:"temp"in i.sizes},a);switch(t){case r:g.data={sizes:i.sizes,ratio:i.ratio,label:i.label,href:i.href},g.doc=g.data;break;case s:g.data={pid:p,sizes:i.sizes},g.photo=g.data;break;case l:g.data={vid:p,duration:i.duration,platform:i.platform,play_icon:i.play_icon,active_live:i.active_live,ratio:i.ratio,sizes:i.sizes,name:i.name},g.video=g.data;break;case h:g.data={aid:p,title:i.title,size:i.size,thumb:{sizes:i.sizes}},g.album=g.data;break;case d:g.data={type:d,aid:p,title:i.title,msize:i.msize,thumb:{sizes:i.sizes}},g.market_album=g.data}return g.data.type=t,g.data.id=g.temp?t+"temp_"+v:""+t+g.ownerId+"_"+g.itemId,g},isValidThumbType:C};try{stManager.done(jsc("web/thumbs_edit.js"))}catch(t){}}});