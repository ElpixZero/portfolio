!function(e){var o={};function a(i){if(o[i])return o[i].exports;var t=o[i]={i:i,l:!1,exports:{}};return e[i].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=e,a.c=o,a.d=function(e,o,i){a.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,o){if(1&o&&(e=a(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var t in e)a.d(i,t,function(o){return e[o]}.bind(null,t));return i},a.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(o,"a",o),o},a.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},a.p="",a(a.s=154)}({154:function(e,o,a){e.exports=a("LSJr")},"8h6g":function(e,o,a){"use strict";a.d(o,"b",function(){return i}),a.d(o,"c",function(){return t}),a.d(o,"a",function(){return d});var i="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),t=5,d=4194304},Bwan:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";var _video_upload_vars__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("8h6g");__webpack_exports__.a={FILE_TYPES:"",UPLOAD_ACCEPT:"",showBox:function(e){function o(o){return e.apply(this,arguments)}return o.toString=function(){return e.toString()},o}(function(e){return re("video_upload_box_placeholder"),cur.uploadBanned?(showFastBox({title:getLang("video_no_upload_title")},getLang("video_claims_no_upload")),!1):ge("video_upload_tab")||4!=vk.al?(e=e||{},(e=extend(e,{act:"upload_box",ocl:cur.ocl?1:0})).oid||(e.oid=cur.oid||vk.id),cur.uploadVideoBox=showBox("al_video.php",e,{stat:["video_edit.css","privacy.css","privacy.js"],params:{bodyStyle:"position: relative;",dark:1,onHide:window.VideoUpload.onHideUploadPanel,onDestroy:window.VideoUpload.onDestroyUploadBox,onShow:window.VideoUpload.onShowUploadPanel,width:452},onDone:function(){ge("video_upload_box_wrapper")&&(cur.uploadVideoBox.removeButtons(),hide(domNS(cur.uploadVideoBox.bodyNode))),inArray(e.from,["post","comment","message"])&&window.VideoUpload.toExternalAdd(e.from)}}),!1):nav.go("videos"+cur.oid+"?z=upload_video")}),init:function(){window.VideoUpload.buildExtMasks(),window.VideoUpload.startEvents()},buildExtMasks:function(){var e=_video_upload_vars__WEBPACK_IMPORTED_MODULE_0__.b;window.VideoUpload.UPLOAD_ACCEPT="."+e.join(",.");for(var o=e.length,a=0;a<o;++a)e.push(e[a].toUpperCase());window.VideoUpload.FILE_TYPES="*."+e.join(";*.")},startEvents:function(){addEvent(boxLayerWrap,"scroll",window.VideoUpload.checkResize),addEvent(window,"resize",window.VideoUpload.checkResize)},stopEvents:function(){removeEvent(boxLayerWrap,"scroll",window.VideoUpload.checkResize),removeEvent(window,"resize",window.VideoUpload.checkResize)},onHideUploadPanel:function(){addClass(ge("video_upload_box_wrapper"),"video_upload_hide")},onDestroyUploadBox:function(){window.VideoUpload.stopEvents(),delete cur.uploadVideoResizeTimeout,delete window.cur.uploadVideoBox},onShowUploadPanel:function(){ge("video_upload_box_placeholder")&&removeClass(ge("video_upload_box_wrapper"),"video_upload_hide"),window.VideoUpload.doResize()},checkResize:function(){window.VideoUpload.doResize(),cur.uploadVideoResizeTimeout&&clearTimeout(cur.uploadVideoResizeTimeout),cur.uploadVideoResizeTimeout=setTimeout(window.VideoUpload.doResize,1)},destroyTab:function(){var e=ge("video_upload_tab");if(e){var o=geByClass("video_upload_item_panel",e);each(o,function(e){var a=o[e];cleanElems(a)})}},doResize:function(){if(isVisible("video_upload_box_wrapper")){var e=ge("video_upload_box_wrapper"),o=ge("video_upload_box_placeholder");if(e&&o){var a=getXY(o);setStyle(e,"left",a[0]),setStyle(e,"top",a[1])}}},onPrivacyChanged:function(e){var o=cur.tag2ElMap[e.substr(5)],a=geByClass1("video_upload_status_export",o);Privacy.getValue(e)>0?(removeClass(a,"on"),addClass(a,"disabled")):removeClass(a,"disabled")},initUpload:function initUpload(url,vars,uploadLang,uploadOpts,uiLang,itemTemplate){cur.lang=extend(cur.lang||{},uiLang);var hashs={};if(hashs[vars.tag]=uploadOpts.update_db_hash,cur.videoHashs=extend(cur.videoHashs||{},hashs),!ge("video_dropbox")){var p=ge("video_upload_box_tab").parentNode.parentNode.parentNode,d=se('<div id="video_dropbox" class="dropbox choose">\n          <div class="dropbox_wrap">\n            <div class="dropbox_area">\n              <div class="dropbox_label">'+uploadLang.drop_files_here+"</div>\n            </div>\n          </div>\n        </div>");p.appendChild(d)}var el=void 0;(el=ge("video_upload_box_wrapper"))?window.VideoUpload.onShowUploadPanel():(el=ce("div",{id:"video_upload_box_wrapper"}),bodyNode.appendChild(el),cur.destroy.push(function(){re("video_upload_box_wrapper")}));var children=geByClass("noselect",el,"div");each(children,function(e){addClass(children[e],"video_upload_hide")});var uploadItem=se('<div id="video_upload_box'+vars.tag+'" class="noselect"></div>');el.appendChild(uploadItem);var placeholder=ge("video_upload_box_placeholder"),initButton=function initButton(){var uploadErrorInfo=ge("video_upload_fail_info");uploadErrorInfo&&(hide(uploadErrorInfo),setTimeout(function(){var e=getSize(placeholder);setStyle(el,"width",e[0]),setStyle(el,"height",e[1]),setStyle(placeholder,"width",e[0]),setStyle(placeholder,"height",e[1]),window.VideoUpload.doResize(),re(domFC(placeholder))}),Upload.init("video_upload_box"+vars.tag,url,vars,{file_name:"video_file",file_size_limit:1024*(uploadOpts.file_size_limit_in_GB||_video_upload_vars__WEBPACK_IMPORTED_MODULE_0__.c)*1024*1024,file_types_description:"Video files",file_types:window.VideoUpload.FILE_TYPES,lang:uploadLang,flat_button:1,filesize_hide_last:1,chunked:1,chunkSize:_video_upload_vars__WEBPACK_IMPORTED_MODULE_0__.a,onUploadStart:function(e,o){var a=void 0!==e.ind?e.ind:e;cur._uploadStart=vkNow(),delete window.VideoUpload.videoUploadCallback;var i=function(){cur.ocl||(nav.objLoc.section="upload",nav.setLoc(nav.objLoc));var o=se(rs(itemTemplate,{id:a}));window.VideoUpload.initBeforeUnload();var i=ge("video_upload_tab");if(geByClass1("video_upload_item_panel",i)?(addClass(o,"video_upload_with_divider"),i.insertBefore(o,domNS(ge("video_upload_no_video")))):i.appendChild(o),hide("video_upload_no_video"),cur.ocl&&cur.oid>0){each(geByClass("video_upload_privacy"),hide),hide("video_edit_repeat"),hide(geByClass1("video_upload_status_export")),hide(geByClass1("video_upload_publish_later"));var t=geByClass1("video_upload_ready_button");t.parentNode.insertBefore(se('<div><div class="video_ocl_warn">'+getLang("video_ocl_privacy")+"</div></div>"),t)}if(vars.oid>0&&(cur.privacy["video"+vars.tag]||(cur.privacy["video"+vars.tag]=cur.privacy.video,cur.privacy["videocomm"+vars.tag]=cur.privacy.video),Privacy.update("video"+vars.tag),Privacy.update("videocomm"+vars.tag),cur.tag2ElMap=cur.tag2ElMap||{},cur.tag2ElMap[vars.tag]=o,cur.onPrivacyChanged=window.VideoUpload.onPrivacyChanged),curBox()&&curBox().hide(),hide("video_main_block"),hide("videocat_other_blocks"),show("video_upload_block"),cur.videoReupload&&(window.VideoUpload.deleteItem(cur.videoReupload,!1),delete cur.videoReupload),show(i),show(o),e.fileName){var d=e.fileName,r=void 0,n=window.VideoUpload.FILE_TYPES.split(";");each(n,function(e,o){if((r=d.indexOf(o.substr(1)))==d.length-o.length+1)return d=d.substr(0,r),!1});var l=geByClass1("video_upload_item_name",i);val(l,d),l.select()}window.VideoUpload.videoUploadCallback&&(window.VideoUpload.videoUploadCallback(),delete window.VideoUpload.videoUploadCallback),cur.videoThumbUploadOpts&&isObject(cur.videoThumbUploadOpts)&&window.VideoUpload.initThumbUpload(cur.videoThumbUploadOpts,o),window.VideoUpload._uploadAlbumChooser=window.VideoUpload._uploadAlbumChooser||{},cur.videoPlaylists&&cur.videoPlaylists.length?window.VideoUpload._uploadAlbumChooser[a]=new Dropdown(geByClass1("video_upload_album_chooser_input",o),[[0,getLang("video_upload_choose_album_placeholder")]].concat(cur.videoPlaylists),{autocomplete:!0,width:270,selectedItems:[uploadOpts.aid||0],big:!0}):re(geByClass1("video_upload_album_chooser_wrap",o))};if(ge("video_upload_tab"))i();else{var t=cur.privacy,d=cur.videoHashs,r=cur.videoThumbUploadOpts,n=cur.videoUploadThumbBtnTpl,l=cur.videoPlaylists;curBox().hide(),nav.go("videos"+vars.oid,!1,{nocur:!0,onDone:function(){setTimeout(function(){cur.lang=extend(cur.lang||{},uiLang),cur.privacy=extend(cur.privacy||{},t),cur.videoHashs=extend(cur.videoHashs||{},d),cur.videoThumbUploadOpts=r,cur.videoUploadThumbBtnTpl=n,cur.videoPlaylists=l,i()})},params:{ocl:cur.ocl?1:null}})}},onUploadComplete:function onUploadComplete(i,res){var obj=void 0,ind=void 0!==i.ind?i.ind:i;if(res){try{obj=eval("("+res+")")}catch(e){obj=q2ajx(res)}if(obj.code||obj.error)Upload.onUploadError(i,obj);else{var videoId=obj.video_id,videoHash=obj.video_hash,item=ge("video_upload_item_"+ind),callback=function(){var e=ge("video_upload_item_"+ind);domData(e,"video_id",videoId),domData(e,"uploaded",1),window.VideoUpload.setUploadStatus(getLang("video_upload_link_text"),e);var o=geByClass1("video_upload_link",e,"a");if(o){o.innerHTML=rs(o.innerHTML,{video_id:videoId}),o.href="//"+rs(o.getAttribute("data-href-tpl"),{video_id:videoId}),show(o);var a=geByClass1("video_upload_ready_name",e);if(a){var i=ce("a",{innerHTML:a.innerHTML,className:a.className,href:o.href});domPN(a).insertBefore(i,a),re(a)}}for(var t=geByClass("video_upload_ready_button"),d=0;d<t.length;d++){var r=t[d],n=window.VideoUpload.getUploadItem(r);domData(n,"saved")&&window.VideoUpload.saveParams(r)}window.VideoUpload.setStatusHeader(getLang("video_upload_encode_waiting"),e),window.VideoUpload.setProgressValue(100,getLang("video_upload_waiting"),e),window.VideoUpload.runVideoProgressUpdate(e,vars.oid,videoId,videoHash,1,-1,0)};item?callback():window.VideoUpload.videoUploadCallback=callback}}},onUploadProgress:function(e,o,a){var i=void 0!==e.ind?e.ind:e,t=intval(o/a*100),d=o/a*100,r=ge("video_upload_item_"+i);if(r){data(r,"progress")>t&&data(r,"max_size_error",!0),data(r,"progress",t);var n=getLang("video_upload_uploaded_percent").replace("{percent}",t);window.VideoUpload.setProgressValue(d,n,r)}},onUploadError:function onUploadError(i,err){var debug=void 0;if(err&&(err.code||err.error)){try{debug=eval("("+err.debug+")")}catch(e){debug=q2ajx(debug)}err=err.code?err.code:err.error}else debug=!1;var logErrorData={oid:vars.oid,mid:vars.mid,tag:vars.tag,srv:uploadOpts.server,extra:err};window.VideoUpload._logUploadStatus("fail",logErrorData),cur.videoLastError=!0;var ind=void 0!==i.ind?i.ind:i,item=ge("video_upload_item_"+ind),callback=function(){var e=ge("video_upload_item_"+ind);if(e){var o=void 0;-3==err?o=getLang("video_upload_error_file"):-4==err?o=getLang("video_upload_error_audio").replace("{link}",'<a href="/audio">').replace("{/link}","</a>"):-5==err?(o=getLang("video_claimed_not_uploaded"),debug&&debug.claim_id&&(o+=" ["+debug.claim_id+"]")):o=data(e,"max_size_error")?getLang("video_upload_big_file_error"):-12==err?getLang("video_upload_flood_control"):getLang("video_upload_error_common"),window.VideoUpload.showError(e,o)}};item?callback():window.VideoUpload.videoUploadCallback=callback,debugLog(err)},onConnectionLost:function(e){var o=void 0!==e.ind?e.ind:e,a=ge("video_upload_item_"+o);data(a,"upload_index",o),window.VideoUpload.showError(a,getLang("video_upload_connection_lost"),!0)},onDragEnter:function(){hide("video_upload_box_wrapper")},onDragOut:function(){show("video_upload_box_wrapper")},onDrop:function(){show("video_upload_box_wrapper")},clear:1,type:"video",max_attempts:3,server:uploadOpts.server,error:uploadOpts.error,error_hash:uploadOpts.error_hash,dropbox:"video_dropbox",custom_hash:uploadOpts.custom_hash,check_hash:uploadOpts.check_hash,check_rhash:uploadOpts.check_rhash,check_url:uploadOpts.check_url,accept:browser.safari?"":"video/*,"+window.VideoUpload.UPLOAD_ACCEPT}))},intervalId,text,lang,current,errorEl;initButton()},_logUploadStatus:function(e,o){try{o.act="upload_stats",o.stage=e,ajax.post("al_video.php",o)}catch(e){}},removeUploadedThumb:function(e,o){cancelEvent(o);var a=domPN(e);setStyle(a,{backgroundImage:""}),hide(a);var i=gpeByClass("video_tc_uploader",e),t=i.getAttribute("data-thumb-id"),d=gpeByClass("video_upload_item_panel",e),r=window.VideoUpload.getPlaceholderEl(e),n=r?r.getAttribute("data-thumb-id"):0,l="";if(i.setAttribute("data-thumb-id",""),i.setAttribute("data-thumb-url",""),!r||n==t){var s=geByClass("video_tc_item",d);if(s.length>1)return window.VideoUpload.selectThumb(s[1+(s.length-2)/2]),!1;n="",l=r&&r.getAttribute("data-main-thumb"),r&&(r.setAttribute("data-thumb-id",n),setStyle(r,{backgroundImage:l?"url("+l+")":""}))}return!1},initThumbUpload:function(e,o){if(e&&isObject(e)){var a={file_name:"photo",file_size_limit:1024*(e.file_size_limit_in_MB||50)*1024,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF;*.bmp;*.BMP",onUploadStart:function(e,o){show(t),setStyle(d,"width","0%")},onUploadComplete:function(e,o){if(hide(t),setStyle(d,"width","0%"),o){o=window.parseJSON(o);var a=geByClass1("video_tc_upload_image",i);show(a),setStyle(a,{backgroundImage:"url("+o.thumb.l+")"}),i.setAttribute("data-thumb-url",o.thumb.l),i.setAttribute("data-thumb-id",o.photo_id+"_"+o.photo_owner_id),i.setAttribute("data-thumb-hash",o.photo_hash),window.VideoUpload.selectThumb(i)}else topError("Thumb load error")},onUploadProgress:function(e,o,a){var i=intval(o/a*100);i=Math.min(i,100),setStyle(d,"width",i+"%")},onUploadError:function(e,o){hide(t),setStyle(d,"width","0%"),topError("Thumb load error")},clear:1,type:"photo",max_attempts:3,server:e.server,error:e.default_error,error_hash:e.error_hash,noCheck:!0,chooseBox:!0,label:e.specialLabel||cur.videoUploadThumbBtnTpl,uploadButton:!0,buttonClass:"video_tc_upload_btn",accept:".jpg,.jpeg,.png",filesize_hide_last:!0,lang:{filesize_error:getLang("video_upload_thumb_size_error")}},i=geByClass1("video_tc_uploader",o);Upload.init(i,e.url,e.vars,a);var t=geByClass1("video_tc_upload_progress_wrap",o),d=geByClass1("video_tc_upload_progress_bar",o)}},selectThumb:function(e,o){var a=e.getAttribute("data-thumb-url"),i=e.getAttribute("data-thumb-id"),t=e.getAttribute("data-thumb-hash");if(i){var d=domPN(e);each(geByClass("video_tc_item",d),function(){toggleClass(this,"video_tc_item_selected",this==e)});var r=window.VideoUpload.getPlaceholderEl(e);r&&(r.setAttribute("data-thumb-id",i),r.setAttribute("data-thumb-hash",t||""),setStyle(r,{backgroundImage:"url("+a+")"}))}},getPlaceholderEl:function(e){var o=hasClass(e,"video_upload_item_panel")?e:gpeByClass("video_upload_item_panel",e);return geByClass1("video_upload_thumb_placeholder",o)},initTC:function(e,o,a){var i=geByClass1("video_upload_tc_info",a);if(o)val(i.innerHTML,o);else{re(i),e=se(e),geByClass1("video_upload_tc_wrap",a).appendChild(e);var t=geByClass1("video_tc_uploader",a);if(t){var d=geByClass1("video_tc_slider_cont",a);domInsertBefore(t,domFC(d))}var r=window.VideoUpload.getPlaceholderEl(e),n=geByClass("video_tc_item",e);if(r&&!domData(r,"thumb-id")&&n.length>1){var l=geByClass1("video_tc_uploader",e)?1:0;window.VideoUpload.selectThumb(n[Math.floor(l+(n.length-1-l)/2)])}}},runVideoProgressUpdate:function(e,o,a,i,t,d,r,n){ajax.post("al_video.php?act=encode_progress",{oid:o,vid:a,hash:i,need_thumb:t,need_tc:d},{onDone:function(l){if(domPN(e)&&isVisible("video_upload_tab")){var s=!0,_=-1;if(l){if(l.error)return void window.VideoUpload.showError(e,getLang("video_upload_encode_error"));if(t&&l.thumb){var u=window.VideoUpload.getPlaceholderEl(e);u.setAttribute("data-main-thumb",l.thumb),u.getAttribute("data-thumb-id")||setStyle(u,{backgroundImage:"url('"+l.thumb+"')"}),t=""}d&&(l.tc||l.tc_msg)&&(window.VideoUpload.initTC(l.tc,l.tc_msg,e),d=0);var p=l.duration;if(_=l.percents,void 0!==p){if(_>=100){if(r<100){if(l.published)window.VideoUpload.setPublished(e);else{var c=geByClass1("video_upload_progress",e),v=geByClass1("video_upload_ready_message",e);setStyle(c,"opacity",0),setStyle(v,"opacity",1),window.VideoUpload.setStatusHeader(getLang("video_upload_completed_title"),e)}if(t||d){var g=t?2:0;g+=d?1:0,window.VideoUpload._logUploadStatus("no_thumb",{status:g,vid:o+"_"+a})}}}else{var h=getLang("video_upload_encode_percent").replace("{percent}",intval(_));window.VideoUpload.setStatusHeader(getLang("video_upload_encoding"),e),window.VideoUpload.setProgressValue(_,h,e,!0)}_>=100&&!t&&!d&&(s=!1)}else _=-1}s&&setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(e,o,a,i,t,d,_,n),1e3)}},onFail:function(){n||(n=1),setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(e,o,a,i,t,d,r,n+1),2e3*n)}})},showError:function(e,o,a){var i=geByClass1("upload_video_error_panel",e),t=geByClass1("upload_video_info_panel",e),d=geByClass1("upload_video_error_label",e),r=geByClass1("upload_video_try_again_button",e),n=geByClass1("upload_video_resume_button",e);d&&val(d,o),toggle(r,!a),toggle(n,!!a),hide(t),show(i),disableButton(geByClass1("video_upload_ready_button",e),!0),disableButton(geByClass1("video_upload_back_edit",e),!0),domData(e,"error",1)},setPublished:function(e){domData(e,"published",1),window.VideoUpload.setStatusHeader(getLang("video_upload_published_title"),e),window.VideoUpload.setUploadStatus(getLang("video_upload_ready_link_text"),e);var o=geByClass1("video_upload_progress_wrap",e);isVisible(o)&&slideUp(o,{duration:150,transition:Fx.Transitions.swiftOut});var a=geByClass1("video_upload_ready_message",e);isVisible(a)&&slideUp(a,{duration:150,transition:Fx.Transitions.swiftOut});var i=geByClass1("video_upload_status_export",e);window.disable(i);var t=geByClass1("video_upload_publish_later",e);window.disable(t)},setProgressValue:function(e,o,a,i){if(a){var t=geByClass1("video_upload_progress_bar",a),d=geByClass1("video_upload_progress_text",a);toggleClass(geByClass1("video_upload_progress",a),"video_upload_progress_processing",!!i),setStyle(t,{width:e+"%"}),val(d,o)}},saveParams:function(e){disableButton(e,!0);var o=window.VideoUpload.getUploadItem(e),a=o.id.substr("video_upload_item_".length),i=Upload.vars[a],t=window.VideoUpload.getParams(o);t.vid=domData(o,"video_id"),t.oid=i.oid,t.tag=i.tag,t.hash=cur.videoHashs[i.tag],cur.ocl&&(t.ocl=cur.ocl),ajax.post("al_video.php?act=save_video_params",t,{onDone:function(a,i,d){disableButton(e,!1),domData(o,"saved",1),"published"==a&&window.VideoUpload.setPublished(o);var r=geByClass1("js_video_upload_inputs",o),n=geByClass1("js_video_upload_ready",o),l=geByClass1("video_upload_ready_name",n);val(l,i||getLang("video_upload_no_name"));var s=geByClass1("video_upload_ready_description",n);val(s,d||"");var _=geByClass1("video_upload_item_name",o);val(_,(t.title||getLang("video_upload_no_name")).substr(0,cur.videoTitleLength));var u=geByClass1("video_upload_description",o);val(u,(t.desc||"").substr(0,cur.videoDescriptionLength)),isVisible(r)&&!isVisible(n)&&(slideUp(r,{duration:150,transition:Fx.Transitions.swiftOut}),slideDown(n,{duration:150,transition:Fx.Transitions.swiftOut}))}})},deleteParams:function(e){var o=window.VideoUpload.getUploadItem(e),a=function(){var e=geByClass1("js_video_upload_inputs",o),a=geByClass1("js_video_upload_ready",o);slideUp(a,{duration:150,transition:Fx.Transitions.swiftOut}),slideDown(e,{duration:150,transition:Fx.Transitions.swiftOut}),domData(o,"saved",null)};if(domData(o,"published"))a();else{disableButton(e,!0);var i=o.id.substr("video_upload_item_".length),t=Upload.vars[i],d=window.VideoUpload.getParams(o);d.vid=domData(o,"video_id"),d.oid=t.oid,d.tag=t.tag,ajax.post("al_video.php?act=delete_video_params",d,{onDone:function(o){disableButton(e,!1),a()},onError:function(){disableButton(e,!1)}})}},getParams:function(e){var o=e.id.substr("video_upload_item_".length),a=Upload.vars[o],i=a.tag,t=geByClass1("video_upload_status_export",e),d=geByClass1("video_upload_publish_later",e),r=geByClass1("video_upload_no_comments",e),n=geByClass1("video_upload_monetized",e),l=geByClass1("video_upload_item_name",e),s=geByClass1("video_upload_description",e),_=geByClass1("video_edit_repeat",e),u=0;window.VideoUpload._uploadAlbumChooser[o]&&(u=window.VideoUpload._uploadAlbumChooser[o].selectedItems()[0]);var p=window.VideoUpload.getPlaceholderEl(e),c=p.getAttribute("data-thumb-id"),v=p.getAttribute("data-thumb-hash"),g={status_export:isChecked(t),publish_later:isChecked(d),no_comments:isChecked(r),monetized:isChecked(n),title:val(l),desc:val(s),repeat:isChecked(_),album_id:u?u[0]:"",thumb_id:c,thumb_hash:v};return a.oid>0?(g.privacy_video=Privacy.getValue("video"+i),g.privacy_videocomm=Privacy.getValue("videocomm"+i)):g.privacy_video=isChecked("video_upload_group_privacy"),g},setStatusHeader:function(e,o){if(o){var a=geByClass1("video_upload_item_header",o);val(a,e)}},setUploadStatus:function(e,o){var a=geByClass1("video_upload_link_header",o);val(a,e)},showReupload:function(e){var o=window.VideoUpload.getUploadItem(e),a=window.VideoUpload.getParams(o);a.reupload=1,window.VideoUpload.showBox(a),cur.videoReupload=o},resumeUpload:function(e){var o=window.VideoUpload.getUploadItem(e);hide(geByClass1("upload_video_error_panel",o)),show(geByClass1("upload_video_info_panel",o)),disableButton(geByClass1("video_upload_ready_button",o),!1),disableButton(geByClass1("video_upload_back_edit",o),!1),domData(o,"error",null);var a=data(o,"upload_index");Upload.resumeUpload(a)},getUploadItem:function(e){return gpeByClass("video_upload_item_panel",e)},noPublish:function(e){var o=window.VideoUpload.getUploadItem(e),a=geByClass1("video_upload_status_export",o);isChecked(e)?(checkbox(a,0),window.disable(a,1)):window.disable(a,0)},stopUpload:function(e){var o=showFastBox({width:430,title:getLang("video_upload_stop_title"),dark:1,bodyStyle:"padding: 20px;"},getLang("video_upload_stop_text"),getLang("video_upload_stop_button"),function(){o.hide(),Upload.terminateUpload(e);var a=ge("video_upload_item_"+e),i=domData(a,"video_id");if(i){var t=Upload.vars[e];ajax.post("al_video.php",{act:"delete_video",vid:i,oid:t.oid,sure:1})}window.VideoUpload.deleteItem(ge("video_upload_item_"+e),!0)})},deleteItem:function(e,o){var a=domPS(e),i=domNS(e);!a||!hasClass(a,"video_upload_item_panel")||i&&hasClass(i,"video_upload_item_panel")||removeClass(a,"video_upload_with_divider"),o?slideUp(e,{duration:150,transition:Fx.Transitions.swiftOut,onComplete:function(){re(e)}}):re(e),a&&hasClass(a,"video_upload_item_panel")||i&&hasClass(i,"video_upload_item_panel")||(o?slideDown("video_upload_no_video",{duration:150,transition:Fx.Transitions.swiftOut}):show("video_upload_no_video")),cleanElems(e)},initBeforeUnload:function(){cur.nav.push(function(e,o,a,i){if(!1===window.VideoUpload.checkChanges(1))return cur.onContinueCb=nav.go.pbind(a),!1}),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=window.VideoUpload.checkChanges,cur.destroy.push(function(){window.onbeforeunload=cur.prevBefUnload,window.VideoUpload.destroyTab()})},checkChanges:function(e){if(!cur.leaving){var o=ge("video_upload_tab");if(!o)return!1;for(var a="",i="",t=geByClass("video_upload_item_panel",o),d=t.length,r=0,n=0,l=0;l<t.length;l++){var s=t[l];domData(s,"error")?d--:(domData(s,"uploaded")&&r++,domData(s,"saved")&&n++)}if(r!==d)a=getLang("video_upload_changed");else if(n!==d){i=getLang("video_upload_leaving_without_saving",d-n)}if(1===e){if(!a&&!i)return!0;if(a)var _=showFastBox({title:getLang("global_warning"),dark:!0},a,getLang("global_continue"),function(){cur.leaving=!0,_.hide(),cur.onContinueCb&&cur.onContinueCb()},getLang("global_cancel"),function(){_.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)});else if(i)var u=showFastBox({title:getLang("global_warning"),dark:!0},i,getLang("global_save"),function(){u.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc);for(var e=geByClass("video_upload_ready_button"),o=0;o<e.length;o++){var a=e[o];window.VideoUpload.saveParams(a)}},getLang("video_upload_publish_later"),function(){cur.leaving=!0,u.hide(),cur.onContinueCb&&cur.onContinueCb()});return!1}var p=a||i;return p?winToUtf(p.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}},toUploadVideo:function(){var e=cur.uploadVideoBox;window.VideoUpload.checkResize(),window.VideoUpload.onShowUploadPanel(),show("video_upload_box_tab"),hide("video_add_from_youtube_tab"),e.removeButtons(),e.setOptions({hideButtons:1,title:getLang("video_header_new")}),e.addButton(getLang("global_cancel"),e.hide,"no")},toExternalAdd:function(e){var o=cur.uploadVideoBox,a="video"===e?this.toUploadVideo:o.hide;o.setBackTitle(a),window.VideoUpload.onHideUploadPanel(),hide("video_upload_box_tab"),show("video_add_from_youtube_tab"),o.removeButtons(),isVisible("video_extra_settings")||isVisible("video_share_not_allowed")||isVisible("video_share_error")?(o.setOptions({hideButtons:0}),o.addButton(getLang("global_save"),cur.saveExternalVideo)):o.setOptions({hideButtons:1}),o.addButton(getLang("global_cancel"),o.hide,"no"),ge("video_external_link").focus()},toGroupVideoSelect:function(e){var o=curBox();showBox("al_video.php?act=a_choose_video_box",{from:"video"},{dark:1,onDone:function(e){var o='<div class="back" onclick="curBox().hide();">'+getLang("video_upload_back")+"</div>";e.setOptions({title:o,defaultTitle:o})}}),cur.chooseVideoAdd=function(a,i,t){for(var d=new CallHub(function(){"video"!=cur.module?nav.go("/videos-"+e,!1,{onDone:function(){cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(nav.objLoc[0])}}):(nav.reload(),boxQueue.hideAll(),o.destroy())},a.length),r=0,n=a.length;r<n;r++){var l=a[r],s=ge("video_item_"+l),_=attr(s,"data-add-hash");l=l.split("_");var u=window.Video&&Video.isInAlbum()?Video._getSectionAlbumId():-2;ajax.post("al_video.php",{act:"a_add_to_playlist",oid:l[0],vid:l[1],hash:_,gid:e,add:1,playlist_id:u,list_owner_id:cur.getOwnerId()},{onDone:function(){t&&t(),d.done()},onFail:function(){d.done()}})}return!1}},lockSaveButton:function(){lockButton(curBox().btns.ok[0])},unlockSaveButton:function(){unlockButton(curBox().btns.ok[0])},initShare:function(e,o,a){var i=cur.uploadVideoBox,t=ge("video_external_link");window.placeholderSetup(t,{back:!0});var d=void 0,r=void 0,n=function(){var e=trim(t.value);e&&r!=e&&(i.showProgress(),r=e,ge("video_share_form").submit())};function l(e){d&&clearTimeout(d),e.keyCode==KEY.ENTER?n():d=setTimeout(n,1e3)}var s=void 0;window.onParseDone=function(e){if(hide("video_share_server_error"),hide("video_share_error"),e.images_proxy){var o=ge("video_share_form").action.replace(/\/[^\/]*$/,"")+"/upload.php?act=proxy_img&";each(e.images_proxy,function(a,i){e.images_proxy[a]=o+i})}else e.images_proxy=e.images;if(e.extra>0&&e.extraData&&e.images[0]){if(hide("video_share_descr"),hide("video_share_error"),hide("video_share_not_allowed"),hide("video_share_error"),i.hideProgress(),ge("video_share_photo_url").value=e.url,ge("video_share_photo_image").value=e.images[0],ge("video_share_photo_extra").value=e.extra,cur.changeExternalImage=function(o){cur.externalVideoImage++,e.images[cur.externalVideoImage]?o.src=e.images_proxy[cur.externalVideoImage]:(cur.externalVideoImage=0,o.src=e.images_proxy[0])},e.images[0]){cur.externalVideoImage=0;var t=ge("video_external_image");if(setStyle(t,{backgroundImage:"url('"+e.images_proxy[0]+"')"}),t.setAttribute("onclick","cur.changeExternalImage(this)"),e.images.length>1){var d=vkImage();d.src=e.images_proxy[0],d.onload=function(){d.width<130&&cur.changeExternalImage(ge("video_external_img"))}}!function(){var o=vkImage();o.onerror=function(){var o=!1;each(e.images_proxy,function(e,a){if(0!=e){var i=vkImage();i.onload=function(){o||(o=!0,ge("video_share_photo_image").value=a,cur.externalVideoImage=e,setStyle(t,{backgroundImage:"url('"+a+"')"}))},i.src=a}})},o.src=e.images_proxy[0]}()}ge("video_external_title").value=replaceEntities(e.title),ge("video_external_description").value=replaceEntities(e.description),cur.videoPlaylists.length?cur._addExternalAlbumDD=new Dropdown(geByClass1("video_external_upload_album_chooser_input",curBox().bodyNode),[[0,getLang("video_upload_choose_album_placeholder")]].concat(cur.videoPlaylists),{autocomplete:!0,width:270,selectedItems:[0],big:!0}):re(geByClass1("video_upload_album_chooser_wrap"));var r=getLang("global_save");"video"!==a&&(r=getLang("global_add"),hide("video_external_status_export"),hide(geByClass1("video_upload_album_chooser_wrap")),hide(domByClass(i.bodyNode,"video_upload_privacy_wrap"))),show("video_extra_settings"),s=e,i.removeButtons(),i.addButton(getLang("global_cancel"),i.hide,"no"),cur.saveExternalVideo=function(){e&&e.images&&(window.VideoUpload.lockSaveButton(),cur.shareExternalImageSave=e.images[cur.externalVideoImage],ge("video_share_photo_image").value=cur.shareExternalImageSave,ge("video_share_photo_form").submit())},i.setOptions({hideButtons:0}),i.addButton(r,cur.saveExternalVideo)}else-1==e.extra?(show("video_share_not_allowed"),window.VideoUpload.unlockSaveButton()):(show("video_share_error"),notaBene("video_external_link"),window.VideoUpload.unlockSaveButton())},window.onParseFail=function(){hide("video_share_server_error"),window.VideoUpload.unlockSaveButton(),show("video_share_error"),notaBene("video_external_link")},window.onUploadDone=function(t,d){if(d.photo_id&&d.user_id&&s){var r=s.title;s.title=ge("video_external_title").value;var n=ge("video_external_description").value,l=0;if(cur.vSection){var _=cur.vSection.split("_");"album"===_[0]&&(l=_[1])}var u=extend(s,{oid:e,folder_id:l,act:"save_external",from:a,hash:o,share_title:r||ge("video_external_title").value,share_text:n,image_url:cur.shareExternalImageSave,photo_owner_id:d.user_id,photo_id:d.photo_id,extra:s.extra,extra_data:s.extraData,to_video:"video"===a?1:0,album_id:cur._addExternalAlbumDD?cur._addExternalAlbumDD.selectedItems()[0][0]:"",no_comments:isChecked("video_external_no_comments")?1:0,to_status:isChecked("video_external_status_export")?1:0});u.openGraph&&delete u.openGraph,delete s.extraData,u.oid>0&&(u.privacy_video=Privacy.getValue("video_external"),u.privacy_videocomm=Privacy.getValue("videocomm_external")),delete u.images,delete u.images_proxy,setTimeout(function(){ajax.post("/al_video.php",u,{onDone:function(e){if(hide("share_error"),e.owner_id&&e.video_id)if("video"===a)i.hide(),nav.reload();else{boxQueue.hideAll();var o=e.owner_id+"_"+e.video_id;Video.attachVideos([o])}else window.VideoUpload.unlockSaveButton(),show("video_share_server_error")},onFail:function(e){window.VideoUpload.unlockSaveButton(),hide("video_share_error"),ge("video_share_server_error").innerHTML=e,show("video_share_server_error")}})},0)}else i.showProgress(),show("video_share_error")},window.onUploadFail=function(){i.hideProgress(),hide("video_share_error"),show("video_share_server_error")},addEvent(t,"paste blur",n),addEvent(t,"keydown input",l),cur.destroy.push(function(){removeEvent(t,"paste blur",n),removeEvent(t,"keydown input",l)})},createLiveStream:function(){showBox("al_video.php",{act:"a_add_new_live_trans_form",owner_id:cur.oid},{stat:["video_edit.css","privacy.css","privacy.js","upload.js"],onDone:function(e){if(e.removeButtons(),e.addButton(getLang("video_save_but"),window.VideoUpload.saveLiveStream),e.addButton(getLang("video_cancel_but"),e.hide,"no"),ls.get("video_live_create_form_shown")){var o=domByClass(e.bodyNode,"video_upload_live_launch_steps_wrap");hide(o);var a=domByClass(e.bodyNode,"video_upload_live_launch_subheader");removeClass(a,"_open")}else ls.set("video_live_create_form_shown",1)},onFail:function(e){if(e)return curBox().hide(),showFastBox(getLang("global_error"),e),!0}})},initLiveStreamCategoryDropdown:function(e,o){var a=ge("video_upload_live_category"),i=ge("video_upload_live_game_category"),t=domPN(a).offsetWidth;toggle("video_upload_live_game_category_wrap",3==val(a));var d=new Dropdown(a,e,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:t,onChange:function(e){toggle("video_upload_live_game_category_wrap",3==e)}}),r=new Dropdown(i,o,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:t,onChange:function(){}});cur.destroy.push(function(){d.destroy(),r.destroy()})},getLiveStreamCategoryVal:function(){var e=ge("video_upload_live_category"),o=ge("video_upload_live_game_category");if(!e)return 0;var a=+val(e);if(3==a){var i=+val(o);a=i>0?i:a}return a},toggleLiveLaunchSteps:function(e){toggleClass(e,"_open");var o=domByClass(curBox().bodyNode,"video_upload_live_launch_steps_wrap");window.slideToggle(o,200)},updateLiveTransSettings:function(e,o,a,i){ajax.post("al_video.php",{act:"generate_live_trans_keys",rhash:i,hash:a,owner_id:cur.oid,need_new:e?1:0},{onDone:function(e){val("video_live_trans_settings_url",e.url),val("video_live_trans_settings_key",e.key),o&&o()}})},updatedLiveKeyMsg:function(){showFastBox(getLang("video_live_trans_key_updated"),getLang("video_live_trans_key_updated_msg"))},saveLiveStream:function(){var e=curBox(),o=geByClass1("video_tc_item_selected",e.bodyNode),a=null,i=null;o&&(a=o.getAttribute("data-thumb-id"),i=o.getAttribute("data-thumb-hash"));var t=trim(val("video_new_live_trans_title")),d=trim(val("video_new_live_trans_description")),r=window.VideoUpload.getLiveStreamCategoryVal(),n={owner_id:cur.oid,thumb_id:a,thumb_hash:i,title:t,description:d,category:r,publish:isChecked("video_create_live_publish_on_wall"),preparation_check:isChecked("video_create_live_preparation_check"),notify_followers:isChecked("video_create_live_notify_followers"),enable_donations:isChecked("video_create_enable_donations"),rhash:cur.newLiveHash,random_tag:cur.newLiveRandomTag};return cur.oid<0?n.no_comments=isChecked("video_create_live_no_comments"):(n.privacy_view=Privacy.getValue("video_live_view"),n.privacy_comment=Privacy.getValue("video_live_comment")),!n.title||n.title.length>cur.videoTitleLength?notaBene("video_new_live_trans_title"):n.description.length>cur.videoDescriptionLength?notaBene("video_new_live_trans_description"):n.category?(window.VideoUpload.lockSaveButton(),void ajax.post("al_video.php?act=a_add_new_live_trans",n,{onFail:function(e){return window.VideoUpload.unlockSaveButton(),showFastBox(getLang("video_create_live_error"),e||getLang("video_create_live_error_try_later")),!0}})):notaBene(domClosest("dropdown_container","video_upload_live_category"))}}},LSJr:function(e,o,a){"use strict";a.r(o);var i=a("Bwan"),t=a("rCUf");var d=function(){function e(o,a){!function(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this,e),this.box=o,this.data=a,this.form=domByClass(o.bodyNode,"video_upload_subtitles_form"),this.sectionItems=domByClass(this.box.bodyNode,"video_upload_subtitles_section_items"),this.sectionForm=domByClass(this.box.bodyNode,"video_upload_subtitles_section_form"),this.emitter=new EventEmitter;var i=this.tracksNum();i?i>=this.data.max_tracks_num&&(this.showListHint("Добавлено максимальное количество дорожек"),hide(this.sectionForm)):hide(this.sectionItems),this.initSubtitlesList(),this.initDefaultTrackDropdown(),this.initLangDropdown(),this.initUploadButton()}return e.prototype.initSubtitlesList=function(){var e=this,o=this.data.tracks_list,a="";each(o,function(o,i){a+=e.getTrackHtml(o,i.lang_id)});var i=domByClass(this.box.bodyNode,"video_upload_subtitles_added_list");val(i,a)},e.prototype.initDefaultTrackDropdown=function(){var e=this,o=domByClass(this.box.bodyNode,"video_upload_subtitles_default_track_checkbox"),a=domByClass(this.box.bodyNode,"video_upload_subtitles_default_track_wrap");o.onclick=function(){if(e.data.default_track)e.setDefaultTrack("0");else if(e.tracksNum()>1)e.setDefaultTrack("-1");else{var o=Object.keys(e.data.tracks_list)[0];e.setDefaultTrack(o)}i()};var i=function(){var i=!!e.data.default_track,t=i&&e.tracksNum()>1;if(checkbox(o,i),toggle(a,t),t){var d=e.data.tracks_list,r=e.defaultTrackDropdown,n=[];n.push(["-1","На языке зрителя"]),each(d,function(o,a){var i=e.data.allowed_langs[a.lang_id];n.push([o,i])}),r.setOptions({defaultItems:n}),r.val(e.data.default_track)}},t=domByClass(this.box.bodyNode,"video_upload_subtitles_default_track");this.defaultTrackDropdown=new Dropdown(t,[],{placeholder:"Выберите дорожку",big:!0,width:330,onChange:function(o){e.setDefaultTrack(o)}}),this.emitter.on("tracks_list_change",function(){var o=e.data.tracks_list,a=e.data.default_track;a&&"-1"!=a&&!o[a]&&(e.data.default_track=null),i()}),i()},e.prototype.initLangDropdown=function(){var e=this,o=[];each(this.data.allowed_langs,function(e,a){o.push([e,a])}),this.langDropdown=new Dropdown(this.form.elements.lang,o,{placeholder:"Выберите язык",autocomplete:!0,big:!0,width:160,onChange:function(o){disableButton(e.form.elements.file_button,!o)}})},e.prototype.initUploadButton=function(){var e=this,o=this.form.elements.file_button,a=this.data.upload_params,i=a.options;disableButton(o,!0);var t=domByClass(o,"video_upload_subtitles_button_file_input_container");o.onclick=function(){domFC(t).click()},this.uploadIndex=Upload.init(t,i.url,a.vars,{noFlash:!0,file_name:"subtitles",file_size_limit:1024*i.file_size_limit_in_MB*1024,file_types:"*.srt;*.vtt",clear:!0,type:"subtitles",max_attempts:3,server:i.server,noCheck:!0,chooseBox:!0,accept:".srt,.vtt",lang:{filesize_error:getLang("video_upload_subtitles_size_error")},onUploadStart:function(a,i){lockButton(o),Upload.vars[e.uploadIndex].langId=val(e.form.elements.lang)},onUploadComplete:function(a,i){unlockButton(o);var t=window.parseJSON(i);t?(e.cleanForm(),each(t,function(o,a){e.data.tracks_list[o]||e.appendTrack(o,a.lang_id)}),show(e.sectionItems),e.data.tracks_list=t,e.tracksNum()>=e.data.max_tracks_num&&(hide(e.sectionForm),e.showListHint("Добавлено максимальное количество дорожек")),e.emitter.trigger("tracks_list_change")):topError("upload error")},onUploadError:function(e,a){unlockButton(o),topError("upload error")}})},e.prototype.removeTrack=function(e){var o=this,a=domClosest("video_upload_subtitles_added_item",e),i=domData(a,"track-id");ajax.post("video?act=edit_subtitles_track",{owner_id:this.data.owner_id,video_id:this.data.video_id,track_id:i,action:"remove",hash:this.data.edit_hash},{onDone:function(){delete o.data.tracks_list[i],re(a);var e=o.tracksNum();e<o.data.max_tracks_num&&(show(o.sectionForm),o.hideListHint()),e||hide(o.sectionItems),o.emitter.trigger("tracks_list_change")}})},e.prototype.setDefaultTrack=function(e){this.data.default_track="0"===e?null:e,ajax.post("video?act=edit_subtitles_track",{owner_id:this.data.owner_id,video_id:this.data.video_id,track_id:e,action:"set_default",hash:this.data.edit_hash})},e.prototype.getTrackHtml=function(e,o){var a=this.data.allowed_langs[o];return getTemplate("video_subtitles_upload_item",{track_id:e,track_name:a})},e.prototype.appendTrack=function(e,o){var a=this.getTrackHtml(e,o);domByClass(this.box.bodyNode,"video_upload_subtitles_added_list").insertAdjacentHTML("beforeend",a)},e.prototype.cleanForm=function(){this.langDropdown.val("")},e.prototype.showListHint=function(e){var o=domByClass(this.box.bodyNode,"video_upload_subtitles_added_message");val(o,e)},e.prototype.hideListHint=function(){var e=domByClass(this.box.bodyNode,"video_upload_subtitles_added_message");hide(e)},e.prototype.tracksNum=function(){return Object.keys(this.data.tracks_list).length},e.prototype.destroy=function(){this.langDropdown.destroy(),Upload.deinit(this.uploadIndex)},e}();window.VideoUpload=i.a,window.VideoInlineUpload=t.a,window.VideoSubtitlesUpload=d;try{stManager.done("video_upload.js")}catch(e){}},rCUf:function(e,o,a){"use strict";a.d(o,"b",function(){return r}),a.d(o,"c",function(){return t}),a.d(o,"d",function(){return n});var i=a("8h6g");function t(e){var o=i.b.slice(0,i.b.length);if("types"===e){for(var a=o.length,t=0;t<a;++t)o.push(o[t].toUpperCase());return"*."+o.join(";*.")}return"accept"===e?"."+i.b.join(",."):""}function d(e){if(!cur.leaving){var o=getLang("video_upload_changed"),a=!1;if(each(window.cur.videoUploaders,function(e,o){Upload.isSomethingUploading(o)&&(a=!0)}),1===e){if(!a)return!0;var i=showFastBox({title:getLang("global_warning"),dark:!0},o,getLang("global_continue"),function(){cur.leaving=!0,i.hide(),cur.onContinueCb&&cur.onContinueCb()},getLang("global_cancel"),function(){i.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)});return!1}return a?winToUtf(o.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function r(e,o,a,r,l){if(a){r=r||cur,(l=l||{}).onUploadStart||(l.onUploadStart=function(e){boxQueue.hideLast(),cur.nav.push(function(e,o,a){if(!1===d(1))return cur.onContinueCb=nav.go.pbind(a),!1}),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=d,l.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),l.onUploadStartDone&&l.onUploadStartDone()}),l.onUploadComplete||(l.onUploadComplete=function(e,o){var a=window.parseJSON(o);a.video_id?n(e,a,r):"string"==typeof o&&o.indexOf("TERMINATED")>-1||Upload.onUploadError(e);l.onUploadCompleteDone&&l.onUploadCompleteDone(),setTimeout(function(){l.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&l.onUploadAllCompleteDone()})}),l.onUploadProgress||(l.onUploadProgress=function(e,o,a){var i=void 0!==e.ind?e.ind:e;show("_im_media_preview"),r.showMediaProgress&&r.showMediaProgress("video",i,function(e,o,a){return{loaded:o,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,o,a))}),l.onUploadError||(l.onUploadError=function(e,o){statlogsValueEvent("upload_video_fails",1,a.options.server,o),function(e){var o=void 0!==e.ind?e.ind:e,a=e.fileName?o+"_"+e.fileName:e;if(re("upload"+a+"_progress_wrap"),!geByClass1("popup_box_container")){var i=getLang("video_upload_error");setTimeout(showFastBox({title:getLang("global_error")},i).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+o)||{}).action}),Upload.embed(o)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var s=cur.maxFiles-(cur.savedVideos||[]).length,_=browser.safari?"":"video/*,"+t("accept");a.lang&&(cur.lang=extend(cur.lang||{},a.lang));var u={accept:_,file_input:null,file_name:"video_file",file_size_limit:1024*(a.options.file_size_limit_in_GB||i.c)*1024*1024,file_types_description:"Video files",file_types:t("types"),chooseBox:1,chunked:1,chunkSize:i.a,clear:1,dragEl:o===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:o,from:a.vars.from,lang:a.lang,max_attempts:3,max_files:s,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!a.options.hasOwnProperty("visible_dropbox")||a.options.visible_dropbox},p=Upload.init(e,"",{},Object.assign(u,l));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(p),p}}function n(e,o,a,i){a=a||cur;var t=void 0!==e.ind?e.ind:e,d=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),r=d?t+"_"+d:e,n=o.owner_id+"_"+o.video_id,l=ge("upload"+r+"_progress_wrap");l&&hide(geByClass1("progress_x",l)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:n},{onDone:function(e){a.chooseMedia("video",n,extend(e[n],{upload_ind:r,upload_new:!0}));var t=o.owner_id,d=o.video_id,l=o.video_hash,s=0;!function o(){ajax.post("al_video.php?act=encode_progress",{oid:t,vid:d,hash:l,need_thumb:1},{onDone:function(l){var s=!0;if(l){if(l.error)return void function(e){setTimeout(showFastBox({title:getLang("global_error")},e).hide,2e3)}(getLang("video_upload_encode_error"));l.thumb&&(s=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:t,vid:d},{onDone:function(o){a.hasChosenMedia("video",n)?a.updateChosenMedia("video",n,extend(o,{upload_ind:r,upload_new:!0})):i&&i(e,n)}}))}s&&a.hasChosenMedia("video",n)&&setTimeout(o,1e3)},onFail:function(){++s<3&&setTimeout(o,2e3*s)}})}()}})}o.a={getUploadModule:function(e,o,a,i,t){return r(e,o,a,i,t)},initModalVideoUploader:function(){var e=cur.videoUploadParams,o=ge("choose_video_upload");return!!o&&(this.initDragEvents(),r(o,boxLayerWrap,e))},initDragEvents:function(){var e=function(e){cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var o=ge("video_choose_upload_area_wrap");if(!hasClass(o,"video_choose_upload_area_enter")){addClass(o,"video_choose_upload_area_enter");var a=ge("video_choose_wrap"),i=getXY(a)[1],t=getSize(o)[1];return hide("video_choose_wrap"),setStyle(o,"height",scrollGetY()+window.clientHeight()-i+t),cancelEvent(e)}},o=function(e){return cancelEvent(e)},a=function(e){if(o(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),cancelEvent(e)},i=function(){addEvent(boxLayerWrap,"dragenter dragover",e),addEvent(boxLayerWrap,"dragleave",o),addEvent(boxLayerWrap,"drop",a)};i(),setTimeout(curBox().setOptions.pbind({onHide:function(){removeEvent(boxLayerWrap,"dragenter dragover",e),removeEvent(boxLayerWrap,"dragleave",o),removeEvent(boxLayerWrap,"drop",a)},onShow:function(){i()}}),0)}}}});